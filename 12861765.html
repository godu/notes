<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Sudoku Solver - Godu&#39;s Zettelkasten</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Arthur Weber" name="author" /><meta content="Sudoku is a logic-based, number-placement puzzle." name="description" /><link href="https://godu.github.io/notes/12861765.html" rel="canonical" /><meta content="Sudoku Solver" property="og:title" /><meta content="Godu&#39;s Zettelkasten" property="og:site_name" /><meta content="article" property="og:type" /><meta content="12861765" property="neuron:zettel-id" /><meta content="12861765" property="neuron:zettel-slug" /><meta content="haskell" property="neuron:zettel-tag" /><meta content="sudoku" property="neuron:zettel-tag" /><meta content="theorem solver" property="neuron:zettel-tag" /><meta content="z3" property="neuron:zettel-tag" /><script type="application/ld+json">[]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(224,57,151,0.1)}body nav.bottomPane{background-color:rgba(224,57,151,2.0e-2)}body div#footnotes{border-top-color:#e03997}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#e03997;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(224,57,151,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script><!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Sudoku Solver</h1><h2 id="presentation">Presentation</h2><p>Sudoku is a logic-based, number-placement puzzle.</p><pre><code class="language-none">+-----+-----+-----+            +-----+-----+-----+
|     |     |     |            |9 8 7|6 5 4|3 2 1|
|     |    3|  8 5|            |2 4 6|1 7 3|9 8 5|
|    1|  2  |     |            |3 5 1|9 2 8|7 4 6|
+-----+-----+-----+            +-----+-----+-----+
|     |5   7|     |            |1 2 8|5 3 7|6 9 4|
|    4|     |1    | = solve =&gt; |6 3 4|8 9 2|1 5 7|
|  9  |     |     |            |7 9 5|4 6 1|8 3 2|
+-----+-----+-----+            +-----+-----+-----+
|5    |     |  7 3|            |5 1 9|2 8 6|4 7 3|
|    2|  1  |     |            |4 7 2|3 1 9|5 6 8|
|     |  4  |    9|            |8 6 3|7 4 5|2 1 9|
+-----+-----+-----+            +-----+-----+-----+</code></pre><p>The objectif is to fill a 9x9 grid with digit so that each <strong>column</strong>, each <strong>row</strong> and each <strong>regions</strong> (3x3 subgrids) contain all the digits from 1 to 9.</p><h2 id="implementation">Implementation</h2><h3 id="initialize-board">Initialize board</h3><pre><code class="haskell language-haskell">import  Data.SBV

type Board = [[SWord8]]
type Puzzle = (Int, [SWord8] -&gt; Board)

mkBoard [         a3, a4,     a6, a7, a8, a9
        ,     b2, b3,             b7, b8, b9
        , c1,         c4, c5, c6, c7,     c9
        ,     d2, d3, d4,     d6, d7, d8
        ,     e2, e3,     e5,     e7, e8
        ,     f2, f3, f4,     f6, f7, f8
        , g1,     g3, g4, g5, g6,         g9
        , h1, h2, h3,             h7, h8
        , i1, i2, i3, i4,     i6, i7
        ]
    = [ [  5,  3, a3, a4,  7, a6, a7, a8, a9 ]
      , [  6, b2, b3,  1,  9,  5, b7, b8, b9 ]
      , [ c1,  9,  8, c4, c5, c6, c7,  6, c9 ]
      , [  8, d2, d3, d4,  6, d6, d7, d8,  3 ]
      , [  4, e2, e3,  8, e5,  3, e7, e8,  1 ]
      , [  7, f2, f3, f4,  2, f6, f7, f8,  6 ]
      , [ g1,  6, g3, g4, g5, g6,  2,  8, g9 ]
      , [ h1, h2, h3,  4,  1,  9, h7, h8,  5 ]
      , [ i1, i2, i3, i4,  8, i6, i7,  7,  9 ]
      ]
mkBoard _ = error &quot;puzzle needs exactly 81 elements!&quot;

puzzle :: Puzzle
puzzle = (51, mkBoard)

sudoku :: Puzzle -&gt; Goal
sudoku (i, mkBoard) = do
  board &lt;- mkBoard &lt;$&gt; mkExistVars i
  ...</code></pre><h3 id="constraints">Constraints</h3><blockquote><p>the digits from 1 to 9</p></blockquote><p>Instead of use <code>SInteger</code>, we could use <code>SWord</code>. <code>SWord</code> represent unsigned value and better match our set of value. Finally, <code>SWord8</code> is enough for our use-case.</p><pre><code class="haskell language-haskell">constrain $ sAnd $ inRange &lt;$&gt; concat board
where
  inRange x = 1 .&lt;= x .&amp;&amp; x &lt;= 9</code></pre><blockquote><p>each <strong>column</strong>, each <strong>row</strong> and each <strong>regions</strong> contain all the digits</p></blockquote><pre><code class="haskell language-haskell">constrain $ sAnd $ distinct &lt;$&gt; (rows board) &lt;&gt; (columns board) &lt;&gt; (regions board)</code></pre><h3 id="solution">Solution</h3><pre><code class="haskell language-haskell">type Board = [[SWord8]]
type Puzzle = (Int, [SWord8] -&gt; Board)

sudoku :: Puzzle -&gt; Goal
sudoku (i, mkBoard) = do
  board &lt;- mkBoard &lt;$&gt; mkExistVars i
  constrain $ sAnd $ inRange &lt;$&gt; concat board
  constrain $ sAnd $  distinct &lt;$&gt; (rows board) &lt;&gt; (columns board) &lt;&gt; (regions board)
 where
  inRange x = 1 .&lt;= x .&amp;&amp; x .&lt;= 9
  rows board = board
  columns [ [a1, a2, a3, a4, a5, a6, a7, a8, a9]
          , [b1, b2, b3, b4, b5, b6, b7, b8, b9]
          , [c1, c2, c3, c4, c5, c6, c7, c8, c9]
          , [d1, d2, d3, d4, d5, d6, d7, d8, d9]
          , [e1, e2, e3, e4, e5, e6, e7, e8, e9]
          , [f1, f2, f3, f4, f5, f6, f7, f8, f9]
          , [g1, g2, g3, g4, g5, g6, g7, g8, g9]
          , [h1, h2, h3, h4, h5, h6, h7, h8, h9]
          , [i1, i2, i3, i4, i5, i6, i7, i8, i9]
          ]
        = [ [a1, b1, c1, d1, e1, f1, g1, h1, i1]
          , [a2, b2, c2, d2, e2, f2, g2, h2, i2]
          , [a3, b3, c3, d3, e3, f3, g3, h3, i3]
          , [a4, b4, c4, d4, e4, f4, g4, h4, i4]
          , [a5, b5, c5, d5, e5, f5, g5, h5, i5]
          , [a6, b6, c6, d6, e6, f6, g6, h6, i6]
          , [a7, b7, c7, d7, e7, f7, g7, h7, i7]
          , [a8, b8, c8, d8, e8, f8, g8, h8, i8]
          , [a9, b9, c9, d9, e9, f9, g9, h9, i9]
          ]
  regions [ [a1, a2, a3, a4, a5, a6, a7, a8, a9]
           , [b1, b2, b3, b4, b5, b6, b7, b8, b9]
           , [c1, c2, c3, c4, c5, c6, c7, c8, c9]
           , [d1, d2, d3, d4, d5, d6, d7, d8, d9]
           , [e1, e2, e3, e4, e5, e6, e7, e8, e9]
           , [f1, f2, f3, f4, f5, f6, f7, f8, f9]
           , [g1, g2, g3, g4, g5, g6, g7, g8, g9]
           , [h1, h2, h3, h4, h5, h6, h7, h8, h9]
           , [i1, i2, i3, i4, i5, i6, i7, i8, i9]
           ]
         = [ [a1, a2, a3, b1, b2, b3, c1, c2, c3]
           , [a4, a5, a6, b4, b5, b6, c4, c5, c6]
           , [a7, a8, a9, b7, b8, b9, c7, c8, c9]
           , [d1, d2, d3, e1, e2, e3, f1, f2, f3]
           , [d4, d5, d6, e4, e5, e6, f4, f5, f6]
           , [d7, d8, d9, e7, e8, e9, f7, f8, f9]
           , [g1, g2, g3, h1, h2, h3, i1, i2, i3]
           , [g4, g5, g6, h4, h5, h6, i4, i5, i6]
           , [g7, g8, g9, h7, h8, h9, i7, i8, i9]
           ]

mkBoard [         a3, a4,     a6, a7, a8, a9
        ,     b2, b3,             b7, b8, b9
        , c1,         c4, c5, c6, c7,     c9
        ,     d2, d3, d4,     d6, d7, d8
        ,     e2, e3,     e5,     e7, e8
        ,     f2, f3, f4,     f6, f7, f8
        , g1,     g3, g4, g5, g6,         g9
        , h1, h2, h3,             h7, h8
        , i1, i2, i3, i4,     i6, i7
        ]
    = [ [ 5,  3, a3, a4,  7, a6, a7, a8, a9]
      , [ 6, b2, b3,  1,  9,  5, b7, b8, b9]
      , [c1,  9,  8, c4, c5, c6, c7,  6, c9]
      , [ 8, d2, d3, d4,  6, d6, d7, d8,  3]
      , [ 4, e2, e3,  8, e5,  3, e7, e8,  1]
      , [ 7, f2, f3, f4,  2, f6, f7, f8,  6]
      , [g1,  6, g3, g4, g5, g6,  2,  8, g9]
      , [h1, h2, h3,  4,  1,  9, h7, h8,  5]
      , [i1, i2, i3, i4,  8, i6, i7,  7,  9]
      ]
mkBoard _ = error &quot;puzzle needs exactly 81 elements!&quot;

puzzle = (51, mkBoard)

main :: IO ()
main = do
  actual &lt;- sat (sudoku puzzle)
  print actual</code></pre><pre><code class="language-none">Satisfiable. Model:
  s0  = 4 :: Word8
  s1  = 6 :: Word8
  s2  = 8 :: Word8
  s3  = 9 :: Word8
  s4  = 1 :: Word8
  s5  = 2 :: Word8
  s6  = 7 :: Word8
  s7  = 2 :: Word8
  s8  = 3 :: Word8
  s9  = 4 :: Word8
  s10 = 8 :: Word8
  s11 = 1 :: Word8
  s12 = 3 :: Word8
  s13 = 4 :: Word8
  s14 = 2 :: Word8
  s15 = 5 :: Word8
  s16 = 7 :: Word8
  s17 = 5 :: Word8
  s18 = 9 :: Word8
  s19 = 7 :: Word8
  s20 = 1 :: Word8
  s21 = 4 :: Word8
  s22 = 2 :: Word8
  s23 = 2 :: Word8
  s24 = 6 :: Word8
  s25 = 5 :: Word8
  s26 = 7 :: Word8
  s27 = 9 :: Word8
  s28 = 1 :: Word8
  s29 = 3 :: Word8
  s30 = 9 :: Word8
  s31 = 4 :: Word8
  s32 = 8 :: Word8
  s33 = 5 :: Word8
  s34 = 9 :: Word8
  s35 = 1 :: Word8
  s36 = 5 :: Word8
  s37 = 3 :: Word8
  s38 = 7 :: Word8
  s39 = 4 :: Word8
  s40 = 2 :: Word8
  s41 = 8 :: Word8
  s42 = 7 :: Word8
  s43 = 6 :: Word8
  s44 = 3 :: Word8
  s45 = 3 :: Word8
  s46 = 4 :: Word8
  s47 = 5 :: Word8
  s48 = 2 :: Word8
  s49 = 6 :: Word8
  s50 = 1 :: Word8</code></pre><h4></h4><h2 id="references">References</h2><ul><li><a href="https://www.lri.fr/~conchon/mpri/weber.pdf">A SAT-based Sudoku Solver</a></li></ul></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2020-05-22">2020-05-22</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link"><a href=".">Godu’s Zettlekasten</a></span></span><ul class="context-list" style="zoom: 85%;"></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane" id="neuron-tags-pane"><div><span class="ui basic label zettel-tag" title="Tag">haskell</span><span class="ui basic label zettel-tag" title="Tag">sudoku</span><span class="ui basic label zettel-tag" title="Tag">theorem solver</span><span class="ui basic label zettel-tag" title="Tag">z3</span></div></nav><nav class="ui bottom attached icon compact inverted menu pink" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="right item" href="impulse.html" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.31.0" /></a></div></div></div></body></html>